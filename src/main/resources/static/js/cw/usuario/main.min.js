var $table=$('#tblRegistros'),$index=$('#hIdUsuario'),pageNumber=0,pageSize=0,errorClass='invalid',errorElement='em';$(function(){var a=$('meta[name=\'_csrf\']').attr('content'),b=$('meta[name=\'_csrf_header\']').attr('content');$(document).ajaxSend(function(c,d){d.setRequestHeader(b,a)}),pageSetUp(),listarRegistros(),validarRegistros(),validarBusqueda(),listarPerfiles(),$('#btnNuevo').click(function(){$('#Username').removeAttr('disabled'),irRegistro()}),$('#btnGuardar').click(function(){registro()}),$('#btnCancelar').click(function(){$('#Username').removeAttr('disabled'),irListado($index),$('#frm_registro').trigger('reset')}),$('#btnFiltrar').click(function(){listarRegistros()})});function listarRegistros(){if($('#frm_busqueda').valid()){$table.bootstrapTable('destroy');var b=$('#txtFiltro').val(),c=$('#Estado').val(),d=$('#Perfil').val();(null==b||''==b)&&(b='0'),null==c&&(c='-1'),(null==d||''==d)&&(d='0'),$table.bootstrapTable({url:'/gestion/usuario/obtenerListado/'+b+'/'+c+'/'+d,pagination:!0,sidePagination:'client',pageSize:10,onLoadError:function(f){exception(f.status,f.responseJSON.error)}})}}function registro(){if($('#frm_registro').valid()){var a=$('#btnGuardar');a.button('loading');var b={};b.id=$('#hIdUsuario').val(),b.nombres=$('#Nombres').val(),b.apellidoPaterno=$('#ApellidoPaterno').val(),b.apellidoMaterno=$('#ApellidoMaterno').val(),b.fkPerfil=$('#PerfilId').val(),b.username=$('#Username').val(),b.password=$('#Password').val(),b.flagActivo=$('#FlagActivo').is(':checked'),$.ajax({type:'POST',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:'/gestion/usuario/agregar',dataType:'json',data:b,success:function(c,d){'success'==d&&('-9'==c?$.smallBox({content:'<i> El registro ha fallado debido a que el nombre de usuario ya existe en el sistema...</i>',timeout:4500,color:'alert'}):'2'==c?$.smallBox({content:'<i class=\'fa fa-child fa-2x\'></i> <i>Actualizaci\xF3n exitosa...!</i>'}):$.smallBox({}))},error:function(c){exception(c.status,c.responseJSON.error)},complete:function(){$('#hIdUsuario').val(0),limpiarBusqueda(),irListado($index),listarRegistros(),a.button('reset'),$('#frm_registro').trigger('reset')}})}}function editar(a){var b={};b.id=a,$('#Username').attr('disabled','disabled'),$('#load_pace').show(),$.ajax({type:'GET',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:'/gestion/usuario/obtenerUsuario',dataType:'json',data:b,success:function(c,d){'success'==d&&($('#hIdUsuario').val(c.id),$('#PerfilId').val(c.perfil.id),$('#Username').val(c.username),$('#Password').val(c.password.substring(0,10)),$('#CheckPassword').val(c.password.substring(0,10)),$('#ApellidoPaterno').val(c.apellidoPaterno),$('#ApellidoMaterno').val(c.apellidoMaterno),$('#Nombres').val(c.nombres),!0===c.flagActivo?$('#FlagActivo').prop('checked',!0):$('#FlagActivoOff').prop('checked',!0))},error:function(c){exception(c.status,c.responseJSON.error)},complete:function(){limpiarBusqueda(),$('#Username-error').attr('hidden','hidden'),$('#Username-error').attr('style','display:none'),$('#Password-error').attr('hidden','hidden'),$('#Password-error').attr('style','display:none'),irRegistro(),$('#load_pace').show()}})}function desactivar(a){$.SmartMessageBox({title:'<i class=\'fa fa-bullhorn\'></i> Notificaciones Prosemer',content:'<br/>\xBFQuieres activar o desactivar el registro?',buttons:'[No][Si]'},function(b){if('Si'===b){var c={};c.id=a,$('#load_pace').show(),$.ajax({type:'POST',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:'/gestion/usuario/desactivarUsuario',dataType:'json',data:c,success:function(d,f){'success'==f&&$.smallBox({content:'<i class=\'fa fa-child fa-2x\'></i> <i>Actualizaci\xF3n exitosa...!</i>'})},error:function(d){exception(d.status,d.responseJSON.error)},complete:function(){limpiarBusqueda(),listarRegistros()}})}else;})}function listarPerfiles(){var a=$('#PerfilId'),b=$('#Perfil');$.ajax({type:'GET',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:'/gestion/perfil/listarTodos',dataType:'json',success:function(c,d){'success'==d&&(a.html(''),a.append($('<option />').text('  -- Seleccione -- ')),b.append($('<option />').val('').text('TODOS')),$.each(c,function(){a.append($('<option />').val(this.id).text(this.nombre)),b.append($('<option />').val(this.id).text(this.nombre))}))}})}function linkFormatter(a,b){return String('<a class="editable editable-click" href="#" onclick="javascript:editar('+b.id+')" title="Editar">'+b.nombreCompleto+'</a>',a)}function Opciones(a,b){var d='';return 0<b.id&&(d='<a href=\'#\' onclick=\'javascript:desactivar('+b.id+');\' title=\'Actualizar status\'><i class=\'glyphicon glyphicon-refresh\'></i></a>'),d}function isActived(a,b){return b.flagActivo?'<span class="label label-success">Activo</span>':'<span class="label label-danger">Inactivo</span>'}$.validator.addMethod('pwcheck',function(a){return!(''!=a)||a.match(/^(?=.*\d)(?=.*[a-z])[0-9a-zA-Z!@#\$%\^\&*\)\(+=._-]{8,}$/)});function validarRegistros(){$('#frm_registro').validate({errorClass:errorClass,errorElement:errorElement,highlight:function(a){$(a).parent().removeClass('state-success').addClass('state-error'),$(a).removeClass('valid')},unhighlight:function(a){$(a).parent().removeClass('state-error').addClass('state-success'),$(a).addClass('valid')},ignore:'.ignore',rules:{Nombres:{required:!0,maxlength:$('#Nombres').prop('maxlength')},ApellidoPaterno:{required:!0,maxlength:$('#ApellidoPaterno').prop('maxlength')},ApellidoMaterno:{required:!0,maxlength:$('#ApellidoMaterno').prop('maxlength')},Username:{required:!0,email:!0,maxlength:$('#Username').prop('maxlength')},Password:{required:!0,maxlength:$('#Password').prop('maxlength'),pwcheck:!0},CheckPassword:{equalTo:'#Password'},PerfilId:{required:!0,digits:!0}},messages:{Nombres:{required:'El campo es obligatorio',maxlength:$.validator.format('Este campo debe de tener como m\xE1ximo {0} caracteres.')},ApellidoPaterno:{required:'El campo es obligatorio',maxlength:$.validator.format('Este campo debe de tener como m\xE1ximo {0} caracteres.')},ApellidoMaterno:{required:'El campo es obligatorio',maxlength:$.validator.format('Este campo debe de tener como m\xE1ximo {0} caracteres.')},Username:{required:'<i class=\'form-control-feedback glyphicon glyphicon-remove\'></i>El campo es obligatorio',maxlength:$.validator.format('Este campo debe de tener como m\xE1ximo {0} caracteres.'),email:'Formato inv\xE1lido'},Password:{required:'El campo es obligatorio',maxlength:$.validator.format('Este campo debe de tener como m\xE1ximo {0} caracteres.'),pwcheck:'Password inv\xE1lida, revisar <a style="color:#dd4814;" href="javascript:MostrarRequisitosPassword();">requisitos</a>'},CheckPassword:{equalTo:'Por favor ingresar la misma password nuevamente'},PerfilId:{required:'El campo es obligatorio',digits:'Seleccione un perfil v\xE1lido'}},submitHandler:function(){registro()}})}function validarBusqueda(){$('#frm_busqueda').validate({ignore:'.ignore',errorClass:'my-error-class',validClass:'my-valid-class',rules:{Filtro:{required:!0},Perfil:{digits:!0}},messages:{Filtro:{required:'Debe seleccionar un tipo de formato'},Perfil:{digits:'Debe seleccionar un perfil'}},submitHandler:function(){}})}function MostrarRequisitosPassword(){var a='';a=a+'La contrase\xF1a debe cumplir con las siguientes condiciones:</br></br>',a=a+'<i class=\'fa fa-check\'></i> Tener m\xEDnimo 8 caracteres.</br>',a=a+'<i class=\'fa fa-check\'></i> Tener m\xEDnimo un d\xEDgito.</br>',a=a+'<i class=\'fa fa-check\'></i> Tener m\xEDnimo un caracter en min\xFAscula o may\xFAscula.</br>',a=a+'<i class=\'fa fa-check\'></i> No debe contar con espacios.</br>',a+='<i class=\'fa fa-clock-o\'></i> <bold style="color:#dd4814">Ejemplo: Pablo24rio</bold> ',$.SmartMessageBox({title:'<i class=\'fa fa-bullhorn\'></i> Notificaciones Prosemer',content:'<br/>'+a,buttons:'[Aceptar]'},function(b){})}function limpiarBusqueda(){$('#txtFiltro').val(''),$('#Estado').val('-1'),$('#Perfil').val('')}