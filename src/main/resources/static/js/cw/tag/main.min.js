var $table=$("#tblRegistros"),$index=$("#hIdTag"),pageNumber=0,pageSize=0,errorClass="invalid",errorElement="em";let modalFileSort=$("#sortArchivos").get(0),modalImageSort=$("#sortImagenes").get(0);var iFrameBody="";function listarRegistros(){if($("#frm_busqueda").valid()){var dataRpta;$table.bootstrapTable("destroy");var comodin=$("#txtFiltro").val(),tipo=$("#TipoTag").val();null!=comodin&&""!=comodin||(comodin="0"),null!=tipo&&""!=tipo||(tipo="0"),$table.bootstrapTable({url:"/gestion/tag/obtenerListado/"+comodin+"/"+tipo,pagination:!0,sidePagination:"client",pageSize:10,onLoadSuccess:d=>{},onLoadError:function(xhr,ajaxOptions,thrownError){exception(xhr.status,xhr.responseJSON.error)}})}}function registro(){if($("#frm_registro").valid()){var $btn=$("#btnGuardar");$btn.button("loading");var tags=$("#Tags").val(),params=new Object;params.id=$("#hIdTag").val(),params.nombre=$("#Nombre").val().charAt(0).toUpperCase() + $("#Nombre").val().slice(1),params.tipo=$("#hIdTipoTag").val(),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:"/gestion/tag/agregar",dataType:"json",data:params,success:function(data,textStatus){"success"==textStatus&&("-9"==data?$.smallBox({content:"<i> El registro ha fallado debido a que el nombre de tag ya existe en el sistema...</i>",timeout:4500,color:"alert"}):$.smallBox({content:"El registro ha sido actualizado satisfactoriamente..."}))},error:function(xhr,ajaxOptions,thrownError){exception(xhr.status,xhr.responseJSON.error)},complete:function(data){$("#hIdTag").val(0),limpiarBusqueda(),irListado($index),listarRegistros(),$btn.button("reset")}})}}function editar(id,tipo){var param=new Object;param.id=id,$("#load_pace").show(),$.ajax({type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:"/gestion/tag/obtener",dataType:"json",data:param,success:function(data,textStatus){"success"==textStatus&&($("#hIdTag").val(data.id),$("#hIdTipoTag").val(tipo),$("#Nombre").val(data.nombre),$("#TipoTagId").val(tipo))},error:function(xhr,ajaxOptions,thrownError){exception(xhr.status,xhr.responseJSON.error)},complete:function(data){limpiarBusqueda(),irRegistro(),$("#load_pace").show()}})}function linkFormatter(value,row,index){return String('<a class="editable editable-click" href="#" onclick="javascript:editar('+row.id+","+row.tipoTag.id+')" title="Editar">'+row.nombre+"</a>",value)}function Opciones(value,row,index){return opciones=`<a href='#' onclick='javascript:baja(${row.id});' title='Eliminar Tag'><i class='glyphicon glyphicon-trash text-danger'></i></a> &nbsp`,opciones}function baja(id,tipo,index){$.smallBox({content:"¿Estás seguro de querer eliminar el registro? <p class='text-align-right'><a href='javascript:confirmarBaja("+id+");' class='btn btn-primary btn-sm'>Si</a> <a href='javascript:void(0);' class='btn btn-danger btn-sm'>No</a></p>",color:"#296191",timeout:1e4,icon:"fa fa-bell swing animated",iconSmall:""})}function confirmarBaja(id){$.ajax({type:"DELETE",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:"/gestion/tag/eliminar/"+id,dataType:"json",success:function(data,textStatus){"success"==textStatus&&("-9"==data?$.smallBox({content:"<i> Ha ocurrido un error interno en el sistema. Comunicarse con el administrador...</i>",timeout:4500,color:"alert"}):$.smallBox({content:"El registro se ha eliminado satisfactoriamente."}))},error:function(xhr,ajaxOptions,thrownError){exception(xhr.status,xhr.responseJSON.error)},complete:function(data){listarRegistros()}})}function validarRegistros(){$("#frm_registro").validate({errorClass:errorClass,errorElement:errorElement,highlight:function(element){$(element).parent().removeClass("state-success").addClass("state-error"),$(element).removeClass("valid")},unhighlight:function(element){$(element).parent().removeClass("state-error").addClass("state-success"),$(element).addClass("valid")},ignore:".ignore",rules:{Nombre:{required:!0,maxlength:$("#Nombre").prop("maxlength")}},messages:{Nombre:{required:"El campo es obligatorio",maxlength:$.validator.format("Este campo debe de tener como máximo {0} caracteres.")}},submitHandler:function(){registro()}})}function validarBusqueda(){$("#frm_busqueda").validate({ignore:".ignore",errorClass:"my-error-class",validClass:"my-valid-class",rules:{Filtro:{required:!0},Tipo:{digits:!0}},messages:{Filtro:{required:"Debe seleccionar un tipo de formato"},Tipo:{digits:"Debe seleccionar un tipo"}},submitHandler:function(){}})}function limpiarBusqueda(){$("#txtFiltro").val(""),$("#Estado").val("-1")}$(function(){$(document).on("keypress",function(e){var tag=e.target.tagName.toLowerCase();e.keyCode===$.ui.keyCode.ENTER&&e.preventDefault()});var token=$("meta[name='_csrf']").attr("content"),header=$("meta[name='_csrf_header']").attr("content");$(document).ajaxSend(function(e,xhr,options){xhr.setRequestHeader(header,token)}),pageSetUp(),listarRegistros(),validarRegistros(),validarBusqueda(),$("#btnNuevo").click(function(){window.location.href="/gestion/tag/nuevo"}),$("#btnGuardar").click(function(){registro()}),$("#btnCancelar").click(function(){irListado($index)}),$("#btnFiltrar").click(function(){listarRegistros()})});