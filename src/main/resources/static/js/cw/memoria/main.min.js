var $table=$('#tblRegistros'),$index=$('#hIdMemoria'),pageNumber=0,pageSize=0,alias='',iFrameBody='';$(function(){$(document).on('keypress',function(c){c.target.tagName.toLowerCase();c.keyCode===$.ui.keyCode.ENTER&&c.preventDefault()});var a=$('meta[name=\'_csrf\']').attr('content'),b=$('meta[name=\'_csrf_header\']').attr('content');$(document).ajaxSend(function(c,g){g.setRequestHeader(b,a)}),pageSetUp(),listarRegistros(),CKEDITOR.replace('ckeditor',{height:'380px',startupFocus:!1,on:{instanceReady:getBodyCKEditor}}),$('#btnGuardar').click(function(){registro()}),$('#btnCancelar').click(function(){$('#Username').removeAttr('disabled'),irListado($index)}),$('#UploadOnlyFile').change(function(){subirOnlyFileReemplazo(this)}),$('#UploadResumenImage').change(function(){subirResumenImage(this)}),$('#UploadPortadaImage').change(function(){subirPortadaImage(this)})});function Opciones(a,b){var g='';return g=null==b.nombreArchivo||''==b.nombreArchivo?`<a href='#' title='Aún no se ha subido algún archivo'><i style='color:gray;' class='glyphicon glyphicon-cloud-download'></i></a> &nbsp<a href='#' onclick='javascript:reemplazar(${b.id});' title='Reemplazar o subir archivo'><i class='glyphicon glyphicon-cloud-upload'></i></a> &nbsp<a href='#' onclick='javascript:reemplazarResumenImage(${b.id});' title='Reemplazar o subir imagen de resumen'><i class='glyphicon glyphicon-picture text-danger'></i></a> &nbsp;<a href='#' onclick='javascript:reemplazarPortadaImage(${b.id});' title='Reemplazar o subir imagen portada'><i class='glyphicon glyphicon-picture text-warning'></i></a> &nbsp`:`<a href='#' onclick='javascript:descargar("${b.rutaArchivo}");' title='Descargar archivo'><i class='glyphicon glyphicon-cloud-download'></i></a> &nbsp<a href='#' onclick='javascript:reemplazar(${b.id});' title='Reemplazar o subir archivo'><i class='glyphicon glyphicon-cloud-upload'></i></a> &nbsp<a href='#' onclick='javascript:reemplazarResumenImage(${b.id});' title='Reemplazar o subir imagen de resumen'><i class='glyphicon glyphicon-picture text-danger'></i></a> &nbsp;<a href='#' onclick='javascript:reemplazarPortadaImage(${b.id});' title='Reemplazar o subir imagen portada'><i class='glyphicon glyphicon-picture text-warning'></i></a> &nbsp`,g}function listarRegistros(){$table.bootstrapTable('destroy'),$table.bootstrapTable({url:lang+'/gestion/memoria/obtenerListado',pagination:!0,sidePagination:'client',pageSize:10,onLoadSuccess:()=>{},onLoadError:function(a){exception(a.status,a.responseJSON.error)}})}function registro(){if($('#frm_registro').valid())if(iFrameBody=document.querySelectorAll('.cke_wysiwyg_frame')[0].contentDocument.querySelector('body'),0<iFrameBody.textContent.length){var a=$('#btnGuardar');a.button('loading');var b={};b.id=$('#hIdMemoria').val(),b.tituloPrincipal=$('#TituloPrincipal').val(),b.contenido=iFrameBody.innerHTML,b.resumen=iFrameBody.textContent.substring(0,232).trim()+'...',$.ajax({type:'POST',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:lang+'/gestion/memoria/actualizar',dataType:'json',data:b,success:function(c,g){'success'==g&&('-9'==c?$.smallBox({content:'<i> El registro ha fallado debido a que el nombre de evento ya existe en el sistema...</i>',timeout:4500,color:'alert'}):$.smallBox({content:'El registro ha sido actualizado satisfactoriamente...'}))},error:function(c){exception(c.status,c.responseJSON.error)},complete:function(){$('#hIdMemoria').val(0),irListado($index),listarRegistros(),a.button('reset')}})}else $.smallBox({content:'<i> El <strong>contenido no debe actualizarse como vac\xEDo.</strong></i>',color:'#8a6d3b',iconSmall:'fa fa-warning fa-2x fadeInRight animated',timeout:3500})}function editar(a){var b={};b.id=a,$('#load_pace').show(),$.ajax({type:'GET',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:lang+'/gestion/memoria/obtener',dataType:'json',data:b,success:function(c,g){'success'==g&&($('#hIdMemoria').val(c.id),$('#TituloPrincipal').val(c.tituloPrincipal),iFrameBody.innerHTML=c.contenido)},error:function(c){exception(c.status,c.responseJSON.error)},complete:function(){irRegistro(),$('#load_pace').show()}})}function descargar(a){window.location.href='/media/file/memoria/gt/0'+a,$.smallBox({content:'La descarga ha iniciado...',iconSmall:'fa fa-cloud fa-2x',color:'#296191'})}function reemplazarResumenImage(a){$.smallBox({content:'\xBFEst\xE1s seguro de querer reemplazar la imagen para el resumen? <p class=\'text-align-right\'><a href=\'javascript:confirmarReemplazoResumenImage('+a+')\' class=\'btn btn-primary btn-sm\'>Si</a> <a href=\'javascript:void(0);\' class=\'btn btn-danger btn-sm\'>No</a></p>',color:'#296191',timeout:1e4,icon:'fa fa-paper-plane swing animated',iconSmall:''})}function reemplazarPortadaImage(a){$.smallBox({content:'\xBFEst\xE1s seguro de querer reemplazar la imagen de portada del contenido memoria del proyecto? <p class=\'text-align-right\'><a href=\'javascript:confirmarReemplazoPortadaImage('+a+')\' class=\'btn btn-primary btn-sm\'>Si</a> <a href=\'javascript:void(0);\' class=\'btn btn-danger btn-sm\'>No</a></p>',color:'#296191',timeout:1e4,icon:'fa fa-paper-plane swing animated',iconSmall:''})}function reemplazar(a){$('#hIdMemoria').val(a),$.smallBox({content:'\xBFEst\xE1s seguro de querer reemplazar el archivo? <p class=\'text-align-right\'><a href=\'javascript:confirmarReemplazo()\' class=\'btn btn-primary btn-sm\'>Si</a> <a href=\'javascript:void(0);\' class=\'btn btn-danger btn-sm\'>No</a></p>',color:'#296191',timeout:1e4,icon:'fa fa-bell swing animated',iconSmall:''})}function confirmarReemplazoResumenImage(a){$('#hIdMemoria').val(a),$('#UploadResumenImage')[0].click()}function confirmarReemplazoPortadaImage(a){$('#hIdMemoria').val(a),$('#UploadPortadaImage')[0].click()}function confirmarReemplazo(){$.smallBox({content:'\xBFDesea <strong>agregar un alias</strong> al archivo? <p class=\'text-align-right\'><a href=\'javascript:agregarAlias();\' class=\'btn btn-primary btn-sm\'>Si</a> <a href=\'javascript:continuarSinAlias();\' class=\'btn btn-danger btn-sm\'>No</a></p>',color:'#296191',timeout:1e4,icon:'fa fa-question swing animated',iconSmall:''})}function agregarAlias(){bootbox.prompt('Ingrese el alias:',function(a){a&&(alias=a,$('#UploadOnlyFile')[0].click())})}function continuarSinAlias(){$('#UploadOnlyFile')[0].click()}function subirOnlyFileReemplazo(a){var b;if(b=a.files[0]){var c=new FormData;c.append('file',b),c.append('id',$('#hIdMemoria').val()),c.append('peso',formatBytes(b.size)),0<alias.length&&c.append('alias',alias),$.ajax({type:'POST',url:'/gestion/memoria/archivo',data:c,contentType:!1,processData:!1,success:function(g,h){'success'==h&&('-99'==g?bootbox.alert('El archivo no ha podido ser guardado debido. Para mayor informaci\xF3n comunicarse con el administrador.'):'-1'==g?bootbox.alert('El archivo no ha podido ser guardado debido. Para mayor informaci\xF3n comunicarse con el administrador.'):$.smallBox({content:'<i> El archivo se reemplazo satisfactoriamente...</i>',iconSmall:'fa fa-refresh fa-2x'}))},error:function(g){exception(g.status,g.responseJSON.error)},complete:function(){listarRegistros(),$('#UploadOnlyFile').val(''),alias=''}})}}function subirResumenImage(a){var b=window.URL||window.webkitURL,c,g;(c=a.files[0])&&(g=new Image,g.onload=function(){var h=$('#UploadResumenImage').get(0).files[0],i=new FormData;i.append('file',h),i.append('id',$('#hIdMemoria').val()),$.ajax({type:'POST',url:'/gestion/memoria/imagen/resumen',data:i,contentType:!1,processData:!1,success:function(j,k){'success'==k&&('-99'==j?bootbox.alert('El archivo no ha podido ser guardado debido. Para mayor informaci\xF3n comunicarse con el administrador.'):'-1'==j?bootbox.alert('El archivo no ha podido ser guardado debido. Para mayor informaci\xF3n comunicarse con el administrador.'):$.smallBox({content:'<i> La imagen se reemplazo satisfactoriamente...</i>',iconSmall:'fa fa-refresh fa-2x'}))},error:function(j){exception(j.status,j.responseJSON.error)},complete:function(){$('#UploadResumenImage').val('')}})},g.onerror=function(){bootbox.alert('No se ha seleccionado una imagen v\xE1lida: <strong>'+c.type+'')},g.src=b.createObjectURL(c))}function subirPortadaImage(a){var b=window.URL||window.webkitURL,c,g;(c=a.files[0])&&(g=new Image,g.onload=function(){var h=$('#UploadPortadaImage').get(0).files[0],i=new FormData;i.append('file',h),i.append('id',$('#hIdMemoria').val()),$.ajax({type:'POST',url:'/gestion/memoria/imagen/portada',data:i,contentType:!1,processData:!1,success:function(j,k){'success'==k&&('-99'==j?bootbox.alert('El archivo no ha podido ser guardado debido. Para mayor informaci\xF3n comunicarse con el administrador.'):'-1'==j?bootbox.alert('El archivo no ha podido ser guardado debido. Para mayor informaci\xF3n comunicarse con el administrador.'):$.smallBox({content:'<i> La imagen se reemplazo satisfactoriamente...</i>',iconSmall:'fa fa-refresh fa-2x'}))},error:function(j){exception(j.status,j.responseJSON.error)},complete:function(){$('#UploadPortadaImage').val('')}})},g.onerror=function(){bootbox.alert('No se ha seleccionado una imagen v\xE1lida: <strong>'+c.type+'')},g.src=b.createObjectURL(c))}function getBodyCKEditor(){iFrameBody=document.querySelectorAll('.cke_wysiwyg_frame')[0].contentDocument.querySelector('body')}function linkFormatter(a,b){return String('<a class="editable editable-click" href="#" onclick="javascript:editar('+b.id+')" title="Editar">'+b.tituloPrincipal+'</a>',a)}