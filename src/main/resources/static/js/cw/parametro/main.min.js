var $table=$("#tblRegistros"),$index=$("#hIdParametro"),pageNumber=0,pageSize=0,errorClass="invalid",errorElement="em";function listarRegistros(){if($("#frm_busqueda").valid()){var dataRpta;$table.bootstrapTable("destroy");var comodin=$("#txtFiltro").val();null!=comodin&&""!=comodin||(comodin="0"),$table.bootstrapTable({url:"/gestion/parametro/obtenerListado/"+comodin,pagination:!0,sidePagination:"client",pageSize:10,onLoadSuccess:function(data){},onLoadError:function(xhr,ajaxOptions,thrownError){exception(xhr,xhr)}})}}function registro(){if($("#frm_registro").valid()){var $btn=$("#btnGuardar");$btn.button("loading");var params=new Object;return params.id=$("#hIdParametro").val(),params.clave=$("#Clave").val(),params.valor=$("#Valor").val(),$.ajax({type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:"/gestion/parametro/agregar",dataType:"json",data:params,success:function(data,textStatus){params.id>0?$.smallBox({content:"<i class='fa fa-child'></i> <i>Actualización exitosa...!</i>"}):$.smallBox({})},error:function(xhr,ajaxOptions,thrownError){exception(xhr.status,xhr.responseJSON.error)},complete:function(data){$("#hIdParametro").val(0),limpiarBusqueda(),irListado($index),listarRegistros(),$btn.button("reset")}})}}function editar(id){var param=new Object;param.id=id,$("#load_pace").show(),$.ajax({type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:"/gestion/parametro/obtenerParametro",dataType:"json",data:param,success:function(data,textStatus){"success"==textStatus&&($("#hIdParametro").val(data.id),$("#Clave").val(data.clave),$("#Valor").val(data.valor))},error:function(xhr,ajaxOptions,thrownError){exception(xhr.status,xhr.responseJSON.error)},complete:function(data){limpiarBusqueda(),irRegistro(),$("#load_pace").show()}})}function linkFormatter(value,row,index){return String(`<a class='' href='#' onclick='editar(${row.id})' title='Editar'>${row.clave}</a>`)}function validarRegistros(){$("#frm_registro").validate({errorClass:errorClass,errorElement:errorElement,highlight:function(element){$(element).parent().removeClass("state-success").addClass("state-error"),$(element).removeClass("valid")},unhighlight:function(element){$(element).parent().removeClass("state-error").addClass("state-success"),$(element).addClass("valid")},ignore:".ignore",rules:{Clave:{required:!0,maxlength:$("#Clave").prop("maxlength")},Valor:{required:!0,maxlength:$("#Valor").prop("maxlength")}},messages:{Clave:{required:"El campo es obligatorio",maxlength:$.validator.format("Este campo debe de tener como máximo {0} caracteres.")},Valor:{required:"El campo es obligatorio",maxlength:$.validator.format("Este campo debe de tener como máximo {0} caracteres.")}},submitHandler:function(){registro()}})}function validarBusqueda(){$("#frm_busqueda").validate({ignore:".ignore",errorClass:"my-error-class",validClass:"my-valid-class",rules:{Filtro:{required:!0}},messages:{Filtro:{required:"Debes ingresar un texto a buscar"}},submitHandler:function(){}})}function limpiarBusqueda(){$("#txtFiltro").val("")}$(function(){pageSetUp(),listarRegistros(),validarRegistros(),validarBusqueda(),$("#btnNuevo").click(function(){$("#DescargarImagenFromForm").attr("hidden","hidden"),irRegistro()}),$("#btnGuardar").click(function(){registro()}),$("#btnCancelar").click(function(){irListado($index)}),$("#btnFiltrar").click(function(){listarRegistros()})});