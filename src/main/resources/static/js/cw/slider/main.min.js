var $table=$('#tblRegistros'),$tableTipoImagenes=$('#tblTipoImagenes'),$index=$('#hIdSlider'),photoMobile='',photoWeb='',pageNumber=0,pageSize=0,errorClass='invalid',errorElement='em';$(function(){pageSetUp(),listarRegistros(),eventoSubirImagen(),validarRegistros(),$('#btnNuevo').click(function(){$('#Imagenes').css('display','none'),irRegistro()}),$('#btnGuardar').click(function(){registro()}),$('#btnActualizarMargenes').click(function(){actualizacionMargenes()}),$('#btnCancelar').click(function(){irListado($index),$('#HyperVinculo').val(''),$('#FlagPrincipal').val('')}),$('#btnFiltrar').click(function(){listarRegistros()})});function listarRegistros(){if($('#frm_busqueda').valid()){$table.bootstrapTable('destroy');var b=$('#txtFiltro').val(),c=$('#Estado').val();null==c&&(c='-1'),$table.bootstrapTable({url:'/gestion/slider/obtenerListado/'+c,pagination:!0,sidePagination:'client',pageSize:10,onLoadSuccess:function(){},onLoadError:function(d){exception(d.status,d.responseJSON.error)}})}}function listarTipoImagenes(){$tableTipoImagenes.bootstrapTable('destroy');$tableTipoImagenes.bootstrapTable({url:'/gestion/tipo-imagen/listarTodos',pagination:!0,sidePagination:'client',pageSize:10,onLoadSuccess:function(){},onLoadError:function(b){exception(b.status,b.responseJSON.error)}})}function registro(){if($('#frm_registro').valid()){var a=$('#btnGuardar');a.button('loading');var b={};b.id=$('#hIdSlider').val(),b.hyperVinculo=$('#HyperVinculo').val(),b.flagPrincipal=$('#FlagPrincipal').val(),b.flagActivo=$('#FlagActivo').is(':checked'),b.rutaImagenWeb=photoWeb,b.rutaImagenMobile=photoMobile,$.ajax({type:'POST',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:'/gestion/slider/agregar',dataType:'json',data:b,success:function(c,d){'success'==d&&('2'==c?$.smallBox({content:'<i class=\'fa fa-child fa-2x\'></i> <i>Actualizaci\xF3n exitosa...!</i>'}):$.smallBox({}))},error:function(c){exception(c.status,c.responseJSON.error)},complete:function(){limpiarBusqueda(),irListado($index),listarRegistros(),$('#HyperVinculo').val(''),$('#FlagPrincipal').val(''),a.button('reset')}})}}function editar(a){$('#Imagenes').css('display','');var b={};b.id=a,$('#load_pace').show(),$.ajax({type:'GET',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:'/gestion/slider/obtener',dataType:'json',data:b,success:function(c,d){'success'==d&&($('#hIdSlider').val(c.id),$('#HyperVinculo').val(c.nombre),$('#FlagPrincipal').val(c.flagPrincipal+''),!0==c.flagActivo?$('#FlagActivo').prop('checked',c.flagActivo):$('#FlagActivoOff').prop('checked',!0),photoWeb=c.rutaImagenWeb,photoMobile=c.rutaImagenMobile)},error:function(c){exception(c.status,c.responseJSON.error)},complete:function(){limpiarBusqueda(),irRegistro(),listarTipoImagenes(),cargarImagenes()}})}function actualizacionMargenes(){var b={};b.id=$('#hIdTipoImagen').val(),b.ancho=$('#inpAncho').val(),b.alto=$('#inpAlto').val(),$('#load_pace').show(),$.ajax({type:'PUT',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:'/gestion/tipo-imagen/actualizar-margenes',dataType:'json',data:b,success:function(c,d){'success'==d&&('-9'==c?$.smallBox({content:'Ha ocurrido un error. Por favor comunicarse con el administrador.',color:'#8a6d3b',iconSmall:'fa fa-warning fa-2x fadeInRight animated',timeout:5e3}):($.smallBox({content:'<i class=\'fa fa-child fa-2x\'></i> <i>Actualizaci\xF3n exitosa...!</i>'}),$('#myModalActualizacion').modal('hide')))},error:function(c){null==c.responseJSON?exception(c.status,'Error...'):exception(c.status,c.responseJSON.error)},complete:function(){listarTipoImagenes(),cargarImagenes(),$('#inpAncho').val(''),$('#inpAlto').val('')}})}function activarDesactivar(a){$.smallBox({content:'\xBFEst\xE1s seguro que deseas cambiar el estado del registro seleccionado? <p class=\'text-align-right\'><a href=\'javascript:confirmarActivarDesactivar('+a+')\' class=\'btn btn-primary btn-sm\'>Si</a> <a href=\'javascript:void(0);\' class=\'btn btn-danger btn-sm\'>No</a></p>',color:'#296191',timeout:6e3,icon:'fa fa-paper-plane swing animated',iconSmall:''})}function confirmarActivarDesactivar(a){var b={};b.id=a,$('#load_pace').show(),$.ajax({type:'POST',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:'/gestion/slider/desactivar',dataType:'json',data:b,success:function(c,d){'success'==d&&$.smallBox({content:'<i> El estado ha sido actualizado satisfactoriamente...</i>',iconSmall:'fa fa-refresh fa-2x'})},error:function(c){exception(c.status,c.responseJSON.error)},complete:function(){limpiarBusqueda(),listarRegistros()}})}function hacerPrincipal(a){$.smallBox({content:'\xBFEst\xE1s seguro que desea cambiar este registro como principal en el carrusel? <p class=\'text-align-right\'><a href=\'javascript:confirmarHacerPrincipal('+a+')\' class=\'btn btn-primary btn-sm\'>Si</a> <a href=\'javascript:void(0);\' class=\'btn btn-danger btn-sm\'>No</a></p>',color:'#296191',timeout:6e3,icon:'fa fa-bell swing animated',iconSmall:''})}function confirmarHacerPrincipal(a){var b={};b.id=a,$('#load_pace').show(),$.ajax({type:'PUT',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:'/gestion/slider/principal',dataType:'json',data:b,success:function(c,d){'success'==d&&$.smallBox({content:'<i> El registro<strong> ha sido cambiado como principal para el carrousel...</strong></i>',color:'#c09853',timeout:6e3,icon:'fa fa-star swing animated',iconSmall:''})},error:function(c){exception(c.status,c.responseJSON.error)},complete:function(){limpiarBusqueda(),listarRegistros()}})}function baja(a){$.smallBox({content:'\xBFEst\xE1s seguro de querer eliminar el registro? <p class=\'text-align-right\'><a href=\'javascript:confirmarBaja('+a+');\' class=\'btn btn-primary btn-sm\'>Si</a> <a href=\'javascript:void(0);\' class=\'btn btn-danger btn-sm\'>No</a></p>',color:'#296191',timeout:1e4,icon:'fa fa-bell swing animated',iconSmall:''})}function subirImagen(a,b,c){$('#hIdTipoImagen').val(a),$('#hWImage').val(b),$('#hHImage').val(c),$.smallBox({content:'\xBFEst\xE1s seguro de ingresar o actualizar la imagen? <p class=\'text-align-right\'><a href=\'javascript:document.querySelector("#UploadImage").click();\' class=\'btn btn-primary btn-sm\'>Si</a> <a href=\'javascript:void(0);\' class=\'btn btn-danger btn-sm\'>No</a></p>',color:'#296191',timeout:6e3,icon:'fa fa-question fa-2x swing animated',iconSmall:''})}function cargarImagenes(){var a={};a.id=$('#hIdSlider').val(),$('#load_pace').show(),$.ajax({type:'GET',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:'/gestion/slider-imagen/listarTodos',dataType:'json',data:a,success:function(b,c){if('success'==c)if('-1'==b);else{var d='preImagen',e=0;for(x in b){var f=b[x].tipoImagen.id;$('#'+d+f).attr('onclick','javascript:previsualizar("'+b[x].nombreMedia+'")'),$('#'+d+f).attr('title','Previsualizar imagen'),$('#'+d+f).attr('data-toggle','modal'),$('#'+d+f).attr('data-target','#myModalImage'),$('#'+d+f).children().attr('class','glyphicon glyphicon-eye-open'),$('#'+d+f).removeAttr('style'),0==e?photoWeb=b[x].nombreMedia:photoMobile=b[x].nombreMedia,e++}}},error:function(b){exception(b.status,b.responseJSON.error)},complete:function(){}})}function previsualizar(a){$('#Image').attr('src','/media/image/slider/'+a)}function eventoSubirImagen(){var a=window.URL||window.webkitURL;$('#UploadImage').change(function(){var b=parseFloat($('#hWImage').val()),c=parseFloat($('#hHImage').val()),d,e;(d=this.files[0])&&(e=new Image,e.onload=function(){if(parseFloat(this.width)<=b&&parseFloat(this.height)<=c){var f=$('#UploadImage').get(0).files[0],g=$('#hIdSlider').val(),j=$('#hIdTipoImagen').val(),k=new FormData;k.append('fileSliderImagen',f),k.append('sliderId',g),k.append('tipoImagenId',j),$.ajax({type:'POST',url:'/gestion/slider-imagen/cargarImagen',data:k,contentType:!1,processData:!1,success:function(l,m){'success'==m&&('-99'==l?bootbox.alert('El archivo no ha podido ser guardado debido a que excede los l\xEDmites permitidos de la aplicaci\xF3n, que son 5MB en caso sea un solo archivo y si son m\xE1s de 2, como m\xE1ximo en conjunto no deben exceder a 10MB. Para mayor informaci\xF3n comunicarse con el administrador.'):$.smallBox({content:'<i class=\'fa fa-image fa-2x\'></i><i> La imagen ha sido guardada satisfactoriamente...!</i>'}))},error:function(l){exception(l.status,l.responseJSON.error)},complete:function(){cargarImagenes(),$('#UploadImage').val('')}})}else $.smallBox({content:'No se puede adjuntar. La imagen debe tener margenes<br/><strong> m\xE1ximos de '+b+'px de ancho y '+c+'px de alto.</strong>',color:'#8a6d3b',iconSmall:'fa fa-warning fa-2x fadeInRight animated',timeout:5e3}),$('#UploadImage').val('')},e.onerror=function(){bootbox.alert('No se ha seleccionado una imagen v\xE1lida: <strong>'+d.type+'</strong>')},e.src=a.createObjectURL(d))})}function confirmarBaja(a){$.ajax({type:'DELETE',contentType:'application/x-www-form-urlencoded; charset=UTF-8',url:'/gestion/slider/eliminar/'+a,dataType:'json',success:function(b,c){'success'==c&&('-9'==b?$.smallBox({content:'<i> Ha ocurrido un error interno en el sistema. Comunicarse con el administrador...</i>',timeout:4500,color:'alert'}):$.smallBox({content:'El registro se ha eliminado satisfactoriamente.'}))},error:function(b){exception(b.status,b.responseJSON.error)},complete:function(){listarRegistros()}})}function linkFormatter(a,b){return String('<a class="editable editable-click" href="#" onclick="javascript:editar('+b.id+')" title="Editar">'+b.id+'</a>',a)}function Opciones(a,b){return opciones=`<a href='#' onclick='javascript:activarDesactivar(${b.id});' title='Actualizar estado'><i class='glyphicon glyphicon-refresh'></i></a> &nbsp &nbsp<a href='#' onclick='javascript:hacerPrincipal(${b.id});' title='Cambiar como principal'><i class='glyphicon glyphicon-star text-warning'></i></a> &nbsp<a href='#' onclick='javascript:baja(${b.id});' title='Eliminar Slider'><i class='glyphicon glyphicon-trash text-danger'></i></a> &nbsp`,opciones}function OpcionesImagenes(a,b){var d='<a href="#" onclick="javascript:subirImagen('+b.id+','+b.ancho+','+b.alto+')" id="preImagen'+b.id+'" href="#" title="Subir imagen"><i class="glyphicon glyphicon-upload"></i></a>',e='<a id="preImagen'+b.id+'" href=\'#\' title=\'No existe imagen de este tipo\' style=\'color:#848484;\'><i class=\'glyphicon glyphicon-eye-close\'></i></a>',f='<a href="#" onclick="javascript:actualizarMargenes('+b.id+')" data-toggle="modal" data-target="#myModalActualizacion" id="preImagen'+b.id+'" href="#" title="Editar m\xE1ximos"><i class="glyphicon glyphicon-edit"></i></a>';return e+'  '+d+'  '+f}function wFormat(a,b){return String('<strong><i>'+b.ancho+' px</i></strong>',a)}function hFormat(a,b){return String('<strong><i>'+b.alto+' px</i></strong>',a)}function actualizarMargenes(a){$('#hIdTipoImagen').val(a)}function isMainSlide(a,b){return b.flagPrincipal?'<span class="label label-success">Si</span>':'<span class="label label-danger">No</span>'}function isActived(a,b){return b.flagActivo?'<span class="label label-success">Activo</span>':'<span class="label label-danger">Inactivo</span>'}function validarRegistros(){$('#frm_registro').validate({ignore:'.ignore',errorClass:errorClass,errorElement:errorElement,highlight:function(a){$(a).parent().removeClass('state-success').addClass('state-error'),$(a).removeClass('valid')},unhighlight:function(a){$(a).parent().removeClass('state-error').addClass('state-success'),$(a).addClass('valid')},rules:{HyperVinculo:{maxlength:$('#HyperVinculo').prop('maxlength')},FlagPrincipal:{required:!0}},messages:{HyperVinculo:{maxlength:$.validator.format('Este campo debe de tener como m\xE1ximo {0} caracteres.')},FlagPrincipal:{required:'La selecci\xF3n es obligatoria'}},submitHandler:function(){registro()}})}function limpiarBusqueda(){$('#txtFiltro').val(''),$('#Estado').val('-1')}